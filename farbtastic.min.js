!function(o){o.fn.farbtastic=function(t){return o.farbtastic(this,t),this},o.farbtastic=function(t,r){var t=o(t).get(0);return t.farbtastic||(t.farbtastic=new o._farbtastic(t,r))},o._farbtastic=function(t,r){var a=this;o(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var e=o(".farbtastic",t);a.wheel=o(".wheel",t).get(0),a.radius=84,a.square=100,a.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&o("*",e).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),o(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),a.linkTo=function(t){return"object"==typeof a.callback&&o(a.callback).off("keyup",a.updateValue),a.color=null,"function"==typeof t?a.callback=t:("object"==typeof t||"string"==typeof t)&&(a.callback=o(t),a.callback.on("keyup",a.updateValue),a.callback.get(0).value&&a.setColor(a.callback.get(0).value)),this},a.updateValue=function(o){this.value&&this.value!=a.color&&a.setColor(this.value)},a.setColor=function(o){var t=a.unpack(o);return a.color!=o&&t&&(a.color=o,a.rgb=t,a.hsl=a.RGBToHSL(a.rgb),a.updateDisplay()),this},a.setHSL=function(o){return a.hsl=o,a.rgb=a.HSLToRGB(o),a.color=a.pack(a.rgb),a.updateDisplay(),this},a.widgetCoords=function(t){var r=o(a.wheel).offset();return{x:t.pageX-r.left-a.width/2,y:t.pageY-r.top-a.width/2}},a.mousedown=function(t){document.dragging||(o(document).on("mousemove",a.mousemove).on("mouseup",a.mouseup),document.dragging=!0);var r=a.widgetCoords(t);return a.circleDrag=2*Math.max(Math.abs(r.x),Math.abs(r.y))>a.square,a.mousemove(t),!1},a.mousemove=function(o){var t=a.widgetCoords(o);if(a.circleDrag){var r=Math.atan2(t.x,-t.y)/6.28;r<0&&(r+=1),a.setHSL([r,a.hsl[1],a.hsl[2]])}else{var e=Math.max(0,Math.min(1,-(t.x/a.square)+.5)),s=Math.max(0,Math.min(1,-(t.y/a.square)+.5));a.setHSL([a.hsl[0],e,s])}return!1},a.mouseup=function(){o(document).off("mousemove",a.mousemove),o(document).off("mouseup",a.mouseup),document.dragging=!1},a.updateDisplay=function(){var t=6.28*a.hsl[0];o(".h-marker",e).css({left:Math.round(Math.sin(t)*a.radius+a.width/2)+"px",top:Math.round(-Math.cos(t)*a.radius+a.width/2)+"px"}),o(".sl-marker",e).css({left:Math.round(a.square*(.5-a.hsl[1])+a.width/2)+"px",top:Math.round(a.square*(.5-a.hsl[2])+a.width/2)+"px"}),o(".color",e).css("backgroundColor",a.pack(a.HSLToRGB([a.hsl[0],1,.5]))),"object"==typeof a.callback?(o(a.callback).css({backgroundColor:a.color,color:a.hsl[2]>.5?"#000":"#fff"}),o(a.callback).each(function(){this.value&&this.value!=a.color&&(this.value=a.color)})):"function"==typeof a.callback&&a.callback.call(a,a.color)},a.pack=function(o){var t=Math.round(255*o[0]),r=Math.round(255*o[1]),a=Math.round(255*o[2]);return"#"+(t<16?"0":"")+t.toString(16)+(r<16?"0":"")+r.toString(16)+(a<16?"0":"")+a.toString(16)},a.unpack=function(o){return 7==o.length?[parseInt("0x"+o.substring(1,3))/255,parseInt("0x"+o.substring(3,5))/255,parseInt("0x"+o.substring(5,7))/255]:4==o.length?[parseInt("0x"+o.substring(1,2))/15,parseInt("0x"+o.substring(2,3))/15,parseInt("0x"+o.substring(3,4))/15]:void 0},a.HSLToRGB=function(o){var t,r,a=o[0],e=o[1],s=o[2];return r=s<=.5?s*(e+1):s+e-s*e,t=2*s-r,[this.hueToRGB(t,r,a+.33333),this.hueToRGB(t,r,a),this.hueToRGB(t,r,a-.33333)]},a.hueToRGB=function(o,t,r){return 6*(r=r<0?r+1:r>1?r-1:r)<1?o+(t-o)*r*6:2*r<1?t:3*r<2?o+(t-o)*(.66666-r)*6:o},a.RGBToHSL=function(o){var t,r,a,e,s,n,u=o[0],i=o[1],c=o[2];return t=Math.min(u,Math.min(i,c)),a=(r=Math.max(u,Math.max(i,c)))-t,s=0,(n=(t+r)/2)>0&&n<1&&(s=a/(n<.5?2*n:2-2*n)),e=0,a>0&&(r==u&&r!=i&&(e+=(i-c)/a),r==i&&r!=c&&(e+=2+(c-u)/a),r==c&&r!=u&&(e+=4+(u-i)/a),e/=6),[e,s,n]},o("*",e).on("mousedown",a.mousedown),a.setColor("#000000"),r&&a.linkTo(r)}}(jQuery);